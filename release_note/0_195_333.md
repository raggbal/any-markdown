# v0.195.333 リリースノート

## 変更内容

### 1. 複数段落選択時のTab/Shift+Tab対応

#### 課題
Shift+↑/↓で複数段落を範囲選択した状態でTabキーを押すと、選択された段落のテキストがすべて消失するバグがあった。

#### 原因
段落コンテキストのTabハンドラで `document.execCommand('insertText', false, '    ')` を使用していたが、このAPIはテキスト挿入前に選択範囲を削除する仕様のため、複数ブロックにまたがる選択がすべて消えていた。

v0.195.327で応急処置として「複数ブロック選択時はTab/Shift+Tabを無視するガード」を追加したが、ユーザーから「無視ではなく、選択された各段落に対してTab/Shift+Tabを実行してほしい」とフィードバックがあった。

#### 対策

**設計:**
- 選択範囲の`startContainer`/`endContainer`からエディタ直下のブロック要素を特定
- startBlockからendBlockまでの全ブロック要素を収集
- 各ブロックに対して個別にTab（4スペース挿入）/Shift+Tab（先頭4スペース削除）を実行
- 処理後に選択範囲を復元（オフセット調整込み）

**実装:**
- `src/webview/editor.js` のTabキーハンドラ（段落コンテキスト）を修正
- `TreeWalker`で各ブロックの最初のテキストノードを取得
- Tab: テキストノード先頭に4スペースを挿入
- Shift+Tab: テキストノード先頭から最大4スペースを削除
- 選択範囲のstart/endオフセットを変更量に応じて調整し復元
- 既存のリスト複数選択Tab処理（multi-LI handler）をパターンとして参考にした

### 2. Round-tripテストのファイル依存除去

#### 課題
`roundtrip.spec.ts` の「Round-tripを2回実行しても空行が増えない」テストが、存在しない `samples/b.md` を読み込もうとして毎回ENOENTエラーで失敗していた。

#### 原因
テストが外部ファイル `samples/b.md` に依存していたが、当該ファイルがリポジトリから削除されていた。

#### 対策
外部ファイル依存を除去し、テスト内にインラインでMarkdownデータを定義する形に修正。見出し、段落、リスト、ネストリスト、番号付きリスト、引用、コードブロック、テーブル、水平線、インライン書式を含む網羅的なテストデータを埋め込んだ。
