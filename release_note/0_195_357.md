# v0.195.357-358 リリースノート

## ネストリスト範囲選択Backspaceで子リストが消える／空バレットが残るバグ修正

### 課題

v0.195.356で範囲選択Backspaceの空バレット残存バグを修正したが、2つの問題が残っていた:

1. **子リスト消失**: ネストが深いリストで上位項目を範囲選択してBackspaceすると、選択範囲外の子リストまで消える
2. **空バレット残存**: v0.195.357で子リスト保護のため`<li>`を保持する方式にしたが、空バレットが再度残るようになった

**再現例:**
```
選択範囲: "b"〜"d"
- ab                 v0.195.356:     v0.195.357:      v0.195.358(正):
  - cd               - a             - a              - a
    - ef                              - (空バレット)     - ef
                                        - ef
```

### 原因

**v0.195.356の問題:** ネストリスト `<ul>` ごと親 `<ul>` に `insertBefore` で移動 → `<ul>` 直下 `<ul>` の不正構造 → 親リストの `<li>` 子要素数 0 判定で親ごと削除 → 子リスト消失

**v0.195.357の問題:** ネストリスト持ちの `<li>` を保持＋`<br>` 追加する方式 → 空バレットが残る

### 対策

#### 設計

空 `<li>` のネストリストは、`<ul>` ラッパーごと移動するのではなく、**中身の `<li>` 子要素を親リストに直接昇格**させる。

```
Before:                          After:
outer <ul>                       outer <ul>
  <li>(empty, was "cd")            <li>ef</li>  ← 昇格
    inner <ul>                   </ul>
      <li>ef</li>
    </ul>
  </li>
</ul>
```

#### 実装

```javascript
// ネストリストの子<li>を親リストに昇格してから空<li>を除去
const nestedLists = Array.from(affectedLi.querySelectorAll(':scope > ul, :scope > ol'));
for (const nl of nestedLists) {
    while (nl.firstChild) {
        parentList.insertBefore(nl.firstChild, affectedLi);
    }
    nl.remove();
}
affectedLi.remove();
```

#### テスト

全5テスト＋既存32テスト合格。
