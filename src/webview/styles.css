:root {
    --font-size: __FONT_SIZE__px;
    --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
    --font-mono: 'Menlo', 'Consolas', 'Liberation Mono', 'DejaVu Sans Mono', monospace;
}

[data-theme="github"] {
    --bg-color: #ffffff;
    --text-color: #24292f;
    --heading-color: #1f2328;
    --link-color: #0969da;
    --code-bg: #f6f8fa;
    --code-text: #24292f;
    --border-color: #d0d7de;
    --blockquote-color: #ffffff;
    --blockquote-border: #d0d7de;
    --sidebar-bg: #f6f8fa;
    --toolbar-bg: #f6f8fa;
    --selection-bg: #b6d7ff;
}

[data-theme="sepia"] {
    --bg-color: #fbf8f1;
    --text-color: #5b4636;
    --heading-color: #433422;
    --link-color: #8b6914;
    --code-bg: #f3efe4;
    --code-text: #5b4636;
    --border-color: #d9d3c3;
    --blockquote-color: #ffffff;
    --blockquote-border: #c9c3b3;
    --sidebar-bg: #f3efe4;
    --toolbar-bg: #f3efe4;
    --selection-bg: #e6dcc8;
}

[data-theme="night"] {
    --bg-color: #1a1b26;
    --text-color: #c0caf5;
    --heading-color: #c0caf5;
    --link-color: #7aa2f7;
    --code-bg: #24283b;
    --code-text: #a9b1d6;
    --border-color: #3b4261;
    --blockquote-color: #ffffff;
    --blockquote-border: #3b4261;
    --sidebar-bg: #16161e;
    --toolbar-bg: #16161e;
    --selection-bg: #364a82;
}

[data-theme="dark"] {
    --bg-color: #1e1e1e;
    --text-color: #d4d4d4;
    --heading-color: #ffffff;
    --link-color: #569cd6;
    --code-bg: #252526;
    --code-text: #d4d4d4;
    --border-color: #3c3c3c;
    --blockquote-color: #ffffff;
    --blockquote-border: #3c3c3c;
    --sidebar-bg: #252526;
    --toolbar-bg: #252526;
    --selection-bg: #264f78;
}

[data-theme="minimal"] {
    --bg-color: #fafafa;
    --text-color: #333333;
    --heading-color: #111111;
    --link-color: #333333;
    --code-bg: #f0f0f0;
    --code-text: #333333;
    --border-color: #e0e0e0;
    --blockquote-color: #ffffff;
    --blockquote-border: #cccccc;
    --sidebar-bg: #f5f5f5;
    --toolbar-bg: #f5f5f5;
    --selection-bg: #d0d0d0;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
html, body { height: 100%; overflow: hidden; }
body {
    font-family: var(--font-family);
    font-size: var(--font-size);
    line-height: 1.6;
    color: var(--text-color);
    background-color: var(--bg-color);
}
.container { display: flex; height: 100vh; }

.sidebar {
    width: 260px;
    min-width: 150px;
    max-width: 500px;
    background: var(--sidebar-bg);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    position: relative;
}
.sidebar.hidden { width: 0; min-width: 0; overflow: hidden; }
.sidebar-resizer {
    position: absolute;
    top: 0;
    right: -3px;
    width: 6px;
    height: 100%;
    cursor: col-resize;
    z-index: 10;
}
.sidebar-resizer:hover,
.sidebar-resizer.dragging {
    background: var(--link-color);
    opacity: 0.5;
}
.sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    border-bottom: 1px solid var(--border-color);
}
.sidebar-header h3 { font-size: 14px; font-weight: 600; }
.sidebar-toggle { background: none; border: none; font-size: 18px; cursor: pointer; color: var(--text-color); }
.outline { flex: 1; overflow-y: auto; padding: 8px 0; }
.outline-item {
    display: block;
    padding: 6px 16px;
    color: var(--text-color);
    text-decoration: none;
    font-size: 13px;
    cursor: pointer;
}
.outline-item:hover { background: var(--selection-bg); }
.outline-item[data-level="1"] { padding-left: 16px; font-weight: 600; }
.outline-item[data-level="2"] { padding-left: 28px; }
.outline-item[data-level="3"] { padding-left: 40px; font-size: 13px; }
.outline-item[data-level="4"] { padding-left: 52px; font-size: 12px; }
.outline-item[data-level="5"] { padding-left: 64px; font-size: 12px; color: var(--text-muted); }
.outline-item[data-level="6"] { padding-left: 76px; font-size: 11px; color: var(--text-muted); }

.toolbar .menu-btn { margin-right: 4px; }
.toolbar .menu-btn.hidden { display: none; }
.word-count {
    padding: 12px 16px;
    border-top: 1px solid var(--border-color);
    font-size: 12px;
    color: var(--text-color);
    opacity: 0.7;
}
.word-count div { margin: 4px 0; }

.editor-container { flex: 1; display: flex; flex-direction: column; min-width: 0; }
/* ===== Toolbar: Single row with scroll navigation ===== */
.toolbar {
    display: flex;
    align-items: center;
    padding: 0;
    background: var(--toolbar-bg);
    border-bottom: 1px solid var(--border-color);
    position: relative;
    height: 40px;
}
/* Scrollable inner container */
.toolbar-inner {
    display: flex;
    align-items: center;
    gap: 2px;
    flex: 1;
    overflow-x: auto;
    overflow-y: hidden;
    padding: 4px 12px;
    scrollbar-width: none; /* Firefox */
    min-width: 0;
}
.toolbar-inner::-webkit-scrollbar { display: none; } /* Chrome/Safari */
/* Scroll navigation buttons */
.toolbar-scroll-btn {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--toolbar-bg);
    border: none;
    cursor: pointer;
    color: var(--text-color);
    z-index: 10;
    font-size: 14px;
    font-weight: bold;
    padding: 0;
    opacity: 0.8;
}
.toolbar-scroll-btn:hover {
    opacity: 1;
    background: var(--selection-bg);
}
.toolbar-scroll-btn.hidden { display: none; }
.toolbar-scroll-btn--left {
    left: 0;
    box-shadow: 4px 0 8px -2px rgba(0,0,0,0.1);
}
.toolbar-scroll-btn--right {
    right: 0;
    box-shadow: -4px 0 8px -2px rgba(0,0,0,0.1);
}
/* Toolbar groups */
.toolbar-group {
    display: flex;
    align-items: center;
    gap: 2px;
    flex-shrink: 0;
}
/* Group separator via pseudo-element (replaces .divider spans) */
.toolbar-group + .toolbar-group::before {
    content: '';
    display: block;
    width: 1px;
    height: 20px;
    background: var(--border-color);
    margin: 0 6px;
    flex-shrink: 0;
}
/* Utility group: pushed to right end */
.toolbar-group[data-group="utility"] {
    margin-left: auto;
}
/* Toolbar buttons */
.toolbar button {
    background: none;
    border: none;
    padding: 5px 7px;
    cursor: pointer;
    border-radius: 4px;
    color: var(--text-color);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    min-width: 28px;
    min-height: 28px;
}
.toolbar button:hover { background: var(--selection-bg); }
.toolbar button svg {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
}
/* Lucide stroke-based icons */
.toolbar button svg[fill="none"] { fill: none; }
/* Legacy fill-based icons (e.g. VS Code logo) */
.toolbar button svg:not([fill="none"]) { fill: currentColor; }

.editor-wrapper { flex: 1; overflow: auto; position: relative; }
.editor {
    max-width: 860px;
    margin: 0 auto;
    padding: 40px 60px;
    min-height: 100%;
    outline: none;
    white-space: pre-wrap;
    word-wrap: break-word;
}
.editor.drag-over {
    background: var(--selection-bg);
    outline: 2px dashed var(--link-color);
    outline-offset: -10px;
}
.editor img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 1em 0;
    border-radius: 4px;
}
.source-editor {
    width: 100%;
    height: 100%;
    padding: 40px 60px;
    max-width: 860px;
    margin: 0 auto;
    border: none;
    outline: none;
    resize: none;
    font-family: var(--font-mono);
    font-size: 14px;
    color: var(--text-color);
    background: var(--bg-color);
}

/* Search & Replace Box */
.search-replace-box {
    position: fixed;
    top: 60px;
    right: 40px;
    z-index: 1000;
    background: var(--toolbar-bg);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    min-width: 350px;
}
.search-replace-box .search-row,
.search-replace-box .replace-row {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 8px;
}
.search-replace-box .replace-row {
    margin-bottom: 8px;
}
.search-replace-box input[type="text"] {
    flex: 1;
    padding: 6px 10px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    background: var(--bg-color);
    color: var(--text-color);
    font-size: 13px;
    outline: none;
}
.search-replace-box input[type="text"]:focus {
    border-color: var(--link-color);
}
.search-replace-box .search-count {
    font-size: 12px;
    color: var(--text-color);
    min-width: 40px;
    text-align: center;
}
.search-replace-box button {
    padding: 4px 8px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    background: var(--bg-color);
    color: var(--text-color);
    cursor: pointer;
    font-size: 12px;
}
.search-replace-box button:hover {
    background: var(--selection-bg);
}
.search-replace-box .search-options {
    display: flex;
    gap: 12px;
    font-size: 11px;
    color: var(--text-color);
}
.search-replace-box .search-options label {
    display: flex;
    align-items: center;
    gap: 4px;
    cursor: pointer;
}
.search-replace-box .search-options input[type="checkbox"] {
    margin: 0;
}
.search-highlight {
    background-color: rgba(255, 255, 0, 0.4);
    border-radius: 2px;
}
.search-highlight-current {
    background-color: rgba(255, 165, 0, 0.6);
    border-radius: 2px;
}

.status-bar {
    display: flex;
    justify-content: space-between;
    padding: 6px 16px;
    font-size: 12px;
    color: var(--text-color);
    opacity: 0.7;
    background: var(--toolbar-bg);
    border-top: 1px solid var(--border-color);
}
.status-bar .status-image-dir {
    color: var(--link-color);
    margin-left: 16px;
}
.status-bar .status-image-dir:empty {
    display: none;
}

/* External change toast notification */
.external-change-toast {
    position: fixed;
    top: 12px;
    right: 12px;
    background: var(--toolbar-bg, #f6f8fa);
    color: var(--text-color, #24292f);
    border: 1px solid var(--border-color, #d0d7de);
    border-left: 3px solid var(--link-color, #0969da);
    border-radius: 6px;
    padding: 10px 14px;
    font-size: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    z-index: 10001;
    opacity: 0;
    transform: translateX(100%);
    transition: opacity 0.3s ease, transform 0.3s ease;
    pointer-events: none;
    max-width: 320px;
}
.external-change-toast.show {
    opacity: 1;
    transform: translateX(0);
    pointer-events: auto;
}
.external-change-toast .toast-message {
    line-height: 1.4;
}

.editor h1, .editor h2, .editor h3, .editor h4, .editor h5, .editor h6 {
    color: var(--heading-color);
    margin: 0.5em 0;
    font-weight: 600;
    line-height: 1.25;
}
.editor h1 { font-size: 2em; border-bottom: 1px solid var(--border-color); padding-bottom: 0.3em; }
.editor h2 { font-size: 1.5em; border-bottom: 1px solid var(--border-color); padding-bottom: 0.3em; }
.editor h3 { font-size: 1.25em; }
.editor p, .editor div.paragraph { margin: 0.5em 0; min-height: 1.6em; }
.editor a { color: var(--link-color); text-decoration: none; }
.editor strong, .editor b { font-weight: 600; }
.editor em, .editor i { font-style: italic; }
.editor del, .editor s { text-decoration: line-through; }
.editor code {
    font-family: var(--font-mono);
    font-size: 0.9em;
    background: var(--code-bg);
    padding: 0.2em 0.4em;
    border-radius: 4px;
}
.editor pre {
    background: var(--code-bg);
    padding: 16px;
    border-radius: 6px;
    overflow-x: auto;
    margin: 1em 0;
    font-family: var(--font-mono);
    font-size: 14px;
    white-space: pre;
    word-wrap: normal;
}
.editor pre code {
    display: block;
    padding: 0;
    margin: 0;
    background: transparent;
    font-family: inherit;
    font-size: inherit;
    white-space: pre;
    word-wrap: normal;
}

/* Code block display/edit mode styles */
.editor pre {
    position: relative;
}
.editor pre[data-mode="display"] code {
    cursor: pointer;
}
.editor pre[data-mode="edit"] code {
    /* No outline - cursor is visible */
}
.code-block-header {
    position: absolute;
    top: 4px;
    right: 8px;
    display: flex;
    gap: 8px;
    align-items: center;
    z-index: 10;
}
.code-lang-tag {
    font-size: 11px;
    color: var(--text-color);
    background: var(--border-color);
    padding: 2px 8px;
    border-radius: 4px;
    cursor: pointer;
    user-select: none;
    opacity: 0.8;
}
.code-lang-tag:hover {
    opacity: 1;
    background: var(--selection-bg);
}
.code-copy-btn {
    font-size: 12px;
    color: var(--text-color);
    background: var(--border-color);
    border: none;
    padding: 2px 8px;
    border-radius: 4px;
    cursor: pointer;
    opacity: 0.8;
}
.code-copy-btn:hover {
    opacity: 1;
    background: var(--selection-bg);
}
.code-expand-btn {
    font-size: 14px;
    color: var(--text-color);
    background: var(--border-color);
    border: none;
    padding: 2px 6px;
    border-radius: 4px;
    cursor: pointer;
    opacity: 0.8;
    line-height: 1;
}
.code-expand-btn:hover {
    opacity: 1;
    background: var(--selection-bg);
}
/* Expanded code block - width is set dynamically by JavaScript */
.editor pre.code-expanded {
    position: relative;
    max-width: none;
    box-sizing: border-box;
}
.lang-selector {
    position: fixed;
    background: var(--bg-color);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    max-height: 250px;
    overflow-y: auto;
    z-index: 10000;
    min-width: 140px;
}
.lang-selector-item {
    padding: 6px 12px;
    cursor: pointer;
    font-size: 12px;
}
.lang-selector-item:hover {
    background: var(--selection-bg);
}

/* Mermaid diagram styles */
.editor .mermaid-wrapper {
    margin: 1em 0;
    border-radius: 6px;
    overflow: visible;
}
.editor .mermaid-wrapper pre[data-lang="mermaid"] {
    display: none;
    margin: 0;
    border-radius: 6px 6px 0 0;
}
.editor .mermaid-wrapper[data-mode="edit"] pre[data-lang="mermaid"] {
    display: block;
}
.editor .mermaid-diagram {
    background: var(--bg-color);
    padding: 16px;
    text-align: center;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    min-height: 50px;
}
.editor .mermaid-wrapper[data-mode="edit"] .mermaid-diagram {
    border-radius: 0 0 6px 6px;
    border-top: none;
}
.editor .mermaid-diagram svg {
    max-width: 100%;
    height: auto;
}
.editor .mermaid-diagram .mermaid-error {
    color: #d73a49;
    font-size: 14px;
    padding: 8px;
    background: #ffeef0;
    border-radius: 4px;
}
[data-theme="night"] .editor .mermaid-diagram .mermaid-error {
    background: #3d1f1f;
    color: #f97583;
}

/* KaTeX math block styles */
.editor .math-wrapper {
    margin: 1em 0;
    border-radius: 6px;
    overflow: visible;
}
.editor .math-wrapper pre[data-lang="math"] {
    display: none;
    margin: 0;
    border-radius: 6px 6px 0 0;
}
.editor .math-wrapper[data-mode="edit"] pre[data-lang="math"] {
    display: block;
}
.editor .math-display {
    background: var(--bg-color);
    padding: 16px;
    text-align: center;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    min-height: 40px;
    overflow-x: auto;
}
.editor .math-wrapper[data-mode="edit"] .math-display {
    border-radius: 0 0 6px 6px;
    border-top: none;
}
.editor .math-display .math-error {
    color: #d73a49;
    font-size: 14px;
    padding: 8px;
    background: #ffeef0;
    border-radius: 4px;
}
[data-theme="night"] .editor .math-display .math-error {
    background: #3d1f1f;
    color: #f97583;
}
[data-theme="dark"] .editor .math-display .math-error {
    background: #3d1f1f;
    color: #f97583;
}

/* Syntax highlighting colors */
.hljs-keyword { color: #d73a49; }
.hljs-string { color: #032f62; }
.hljs-number { color: #005cc5; }
.hljs-comment { color: #6a737d; font-style: italic; }
.hljs-function { color: #6f42c1; }
.hljs-built_in { color: #005cc5; }
.hljs-literal { color: #005cc5; }
.hljs-type { color: #d73a49; }
.hljs-attr { color: #005cc5; }
.hljs-tag { color: #22863a; }
.hljs-name { color: #22863a; }
.hljs-selector { color: #6f42c1; }
.hljs-property { color: #005cc5; }
[data-theme="dark"] .hljs-keyword { color: #ff7b72; }
[data-theme="dark"] .hljs-string { color: #a5d6ff; }
[data-theme="dark"] .hljs-number { color: #79c0ff; }
[data-theme="dark"] .hljs-comment { color: #8b949e; }
[data-theme="dark"] .hljs-function { color: #d2a8ff; }
[data-theme="dark"] .hljs-built_in { color: #79c0ff; }
[data-theme="dark"] .hljs-literal { color: #79c0ff; }
[data-theme="dark"] .hljs-type { color: #ff7b72; }
[data-theme="dark"] .hljs-attr { color: #79c0ff; }
[data-theme="dark"] .hljs-tag { color: #7ee787; }
[data-theme="dark"] .hljs-name { color: #7ee787; }
[data-theme="dark"] .hljs-selector { color: #d2a8ff; }
[data-theme="dark"] .hljs-property { color: #79c0ff; }

.editor blockquote {
    margin: 0.5em 0;
    padding: 0 1em;
    color: var(--blockquote-color);
    border-left: 4px solid var(--blockquote-border);
    white-space: pre-wrap;
    word-wrap: break-word;
}
.editor ul, .editor ol { margin: 0.5em 0; padding-left: 2em; }
.editor li { margin: 0.25em 0; }
.editor li > ul, .editor li > ol { margin: 0.25em 0; } /* Nested lists */
.editor hr { border: none; border-top: 2px solid var(--border-color); margin: 1em 0; }
.editor table { border-collapse: collapse; margin: 1em 0; position: relative; max-width: none; }
.editor th, .editor td { border: 1px solid var(--border-color); padding: 8px 12px; min-width: 80px; position: relative; word-wrap: break-word; }
.editor th { background: var(--code-bg); font-weight: 600; text-align: center; }
.editor td { text-align: left; vertical-align: top; }
.editor td:focus, .editor th:focus { outline: 2px solid var(--link-color); outline-offset: -2px; }

/* Table column resize handle */
.table-col-resize-handle {
    position: absolute;
    top: 0;
    right: -3px;
    width: 6px;
    height: 100%;
    cursor: col-resize;
    background: transparent;
    z-index: 10;
    user-select: none;
}
.table-col-resize-handle:hover,
.table-col-resize-handle.resizing {
    background: var(--link-color);
    opacity: 0.5;
}
.table-resizing {
    cursor: col-resize !important;
    user-select: none !important;
}
.table-resizing * {
    cursor: col-resize !important;
    user-select: none !important;
}
.editor img { max-width: 100%; height: auto; }

/* Table floating toolbar */
.table-toolbar {
    position: fixed;
    display: none;
    background: var(--toolbar-bg);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 4px 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    z-index: 1000;
    gap: 2px;
    align-items: center;
}
.table-toolbar.visible {
    display: flex;
}
.table-toolbar button {
    background: transparent;
    border: none;
    padding: 4px 6px;
    cursor: pointer;
    border-radius: 4px;
    color: var(--text-color);
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 26px;
    min-height: 26px;
}
.table-toolbar button:hover {
    background: var(--selection-bg);
}
.table-toolbar button svg {
    width: 14px;
    height: 14px;
    flex-shrink: 0;
}
.table-toolbar button svg[fill="none"] { fill: none; }
.table-toolbar button.text-btn {
    font-size: 11px;
    font-weight: 500;
    white-space: nowrap;
    padding: 4px 8px;
}
.table-toolbar .separator {
    width: 1px;
    height: 18px;
    background: var(--border-color);
    margin: 0 4px;
}
.editor input[type="checkbox"] { margin-right: 8px; }

.editor:empty:before {
    content: 'Start typing... (Try: # heading, - list, > quote, --- hr)';
    color: var(--text-color);
    opacity: 0.4;
}
::selection { background: var(--selection-bg); }
